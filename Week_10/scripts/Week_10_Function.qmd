---
title: "Week 10"
author: "Sk Abidur Rahman"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
format:
  html:
    toc: true
    theme: flatly
execute:
  warning: false
  message: false
---
## Overview
Define two general purpose functions and demonstrate them on **built-in datasets** (`mtcars`, `iris`):

- group_summary: **non-plot**: summary stats by one or two groups (n, mean, sd)  
- smart_scatter: **plot**: clean scatter, color/facet



```{r}
# install.packages(c("tidyverse","here")) 
library(tidyverse)
library(here)

# folders
dir.create(here("Week_10","output"))
```

##Function-1: Non-plot: group_summary()
```{r}
#calculate n, mean, and sd for a numeric column
group_summary <- function(data, value, group1, group2 = NULL) {
  group_cols <- c(group1, group2) |> na.omit() # Combine the grouping columns into a vector, ignoring NULL

  data |> # pipeline
    dplyr::group_by(dplyr::across(dplyr::all_of(group_cols))) |> # Group the data using the column
    
    #Summary statistics 
    dplyr::summarise(
      n    = dplyr::n(),                 # Count the number of rows in the group
      mean = mean(get(value), na.rm = TRUE), # Use get(value) to find the column specified by the string name
      sd   = sd(get(value), na.rm = TRUE),   
      .groups = "drop"                    # Ungroup the data 
    )
}
```

## Grouped by one factor: iris 

```{r}
# Summarize the Sepal.Length by the Species type: both are string
iris_sum_one_group <- group_summary(
  iris, 
  value = "Sepal.Length", # as a string
  group1 = "Species"      # as a string
) 

# Display result
iris_sum_one_group
```

## Grouped by two factor: mtcars

```{r}
#Summarize mpg (miles per gallon) by cyl and am (transmission type)
mtcars_sum_two_groups <- group_summary(
  mtcars, 
  value = "mpg", 
  group1 = "cyl", 
  group2 = "am"
)

# Display result
mtcars_sum_two_groups 

# Save result 
readr::write_csv(
  mtcars_sum_two_groups, 
  here("Week_10","output","mtcars_mpg_by_cyl_am.csv")
)
```


#Function2: Plot- smart_scatter ()
```{r}
# clean, customize scatter plot by smart_scatter
smart_scatter <- function(data, x, y,
                          color,
                          trend = "lm",
                          point_alpha = 0.7,
                          point_size = 2){

## ggplot
  ggplot(data, aes_string(x = x, y = y, color =color)) +
    geom_point(alpha = point_alpha, size = point_size) +
    geom_smooth(method = trend, se = TRUE) +
    labs(
      x = x,
      y = y,
      color = color
    ) +
    theme_minimal(base_size = 12) +
    theme(panel.grid.minor = element_blank())
}
```


#Plot
```{r}
p1 <- smart_scatter(mtcars,
                    x = "wt", 
                    y = "mpg", 
                    color = "cyl", 
                    trend = "lm"
                    )
p1 #display the plot
ggsave(here("Week_10","output","mtcars_mpg_vs_wt_by_cyl.png"),
       plot = p1, width = 8, height = 5, dpi = 320 # save the plot
)
```



```{r}
p2 <- smart_scatter(iris, 
                    x = "Petal.Length", y = "Sepal.Length",
                    color = "Species",
                    trend = "loess", point_alpha = 0.6,
                    point_size = 1.6)

ggsave(
  here("Week_10","output","iris_sepal_vs_petal.png"), 
  plot = p2, width = 10, height = 6, dpi = 320
  )
p2
```


```{r}
p2 ## Do not know, what happend but struggle to visualize in qmd, so I use a seperate chunk to visulaize in qmd.