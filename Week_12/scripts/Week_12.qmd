---
title: "Week 12"
author: "Sk Abidur Rahman"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
format:
  html:
    toc: true
    theme: flatly
execute:
  warning: false
  message: false
---


```{r}
# Load the packages 
library(tidyverse) # Contains readr, dplyr, and ggplot2 for data work
library(here)      # Helps find files 
library(fs)        # Helps list files 

# Create a folder for results
dir.create(here("Week_12", "output"))
```

## Data Preparation

```{r}
file_path <- here("Week_12", "data") ## Point to the folder where the files


files <- dir(path = file_path, pattern = "\\.csv$", full.names = TRUE) #list of all CSV files in the folder # pattern = "\\.csv$" means -find files ending in .csv #full.names = TRUE "give the full path of the file


#Check
print(files)
```


##For Loop :repeats a set of instructions

```{r}
# empty container (a list) to store the results from each file.
results_list <- list() # the loop processes one file at a time

# the loop
for (i in seq_along(files)) { #counts how many files have liek i=1, 2...
  
# Read the current file 
  # files[i] is the name/path of the current file e.g., TP1.csv
current_data <- read_csv(files[i], show_col_types = FALSE) # 'show_col_types = FALSE' keeps output clean.
  
  # Calculate the summary statistics 
  pool_summary <- current_data |>
    group_by(PoolID) |> # group by PoolID to ensure the result is labeled correctly.
    summarise(
mean_temp = mean(Temp.C, na.rm = TRUE),       # the average temperature (Temp.C). 'na.rm = TRUE' means ignore any missing values (NA).
sd_temp   = sd(Temp.C, na.rm = TRUE),         # the standard deviation (SD) for temperature- how much it varies.
mean_light = mean(Intensity.lux, na.rm = TRUE), # average light (Intensity.lux).
sd_light   = sd(Intensity.lux, na.rm = TRUE),   # the standard deviation (SD) for light.
.groups = "drop" # Clean up the grouping 
    )
  
  # Save this single summary result into results_list.
  results_list[[i]] <- pool_summary
}

# Combine all the separate results (the small tables) into one big table.
final_results_loop <- list_rbind(results_list)

# Display the final result from the loop method.
print(final_results_loop)

```


## Map Functions:

```{r}
# Read and Combine all files in one 
combined_data <- files |> 
  map_dfr(read_csv, show_col_types = FALSE) # map_dfr() does three things at once: 1) Loop through all files, 2) read them with read_csv, and 3) stack them into one big dataframe.

# Summarize the single, big dataframe.
final_results_map <- combined_data |> # summarize it all at once using dplyr functions.
  group_by(PoolID) |> # Group by PoolID so get separate rows for each tide pool results.
  summarise(
    mean_temp = mean(Temp.C, na.rm = TRUE),       #  average temperature.
    sd_temp   = sd(Temp.C, na.rm = TRUE),         #the temperature variation.
    mean_light = mean(Intensity.lux, na.rm = TRUE), # the average light.
    sd_light   = sd(Intensity.lux, na.rm = TRUE),   # the light variation.
    .groups = "drop"
  )

# Display the final result from the map method.
print(final_results_map)


```















